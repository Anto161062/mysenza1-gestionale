function doPost(e) {
    var sheet = SpreadsheetApp.openById("1HhtAZqbQI8AcZjdgGi7DdczjC-kb6SegY0RBWwMIDWI").getSheetByName("Ordini");
    var params = e.parameter;

    sheet.appendRow([
        new Date(), // Data ordine
        params.nome, // Nome cliente
        params.email, // Email
        params.prodotto, // Prodotto acquistato
        params.referente, // Chi lo ha portato
        params.amici, // Numero amici portati
        "In elaborazione" // Stato ordine
    ]);

    return ContentService.createTextOutput(JSON.stringify({"status": "success"}))
        .setMimeType(ContentService.MimeType.JSON)
        .setHeader("Access-Control-Allow-Origin", "*")
        .setHeader("Access-Control-Allow-Methods", "POST, GET, OPTIONS")
        .setHeader("Access-Control-Allow-Headers", "Content-Type");
}

function doGet(e) {
    return ContentService.createTextOutput("")
        .setMimeType(ContentService.MimeType.TEXT)
        .setHeader("Access-Control-Allow-Origin", "*")
        .setHeader("Access-Control-Allow-Methods", "POST, GET, OPTIONS")
        .setHeader("Access-Control-Allow-Headers", "Content-Type");
}

function getRewards() {
    var sheet = SpreadsheetApp.openById("1HhtAZqbQI8AcZjdgGi7DdczjC-kb6SegY0RBWwMIDWI").getSheetByName("Ordini");
    var data = sheet.getDataRange().getValues();
    var rewards = [];

    for (var i = 1; i < data.length; i++) {
        if (data[i][5] >= 3) { // Se il cliente ha portato almeno 3 amici
            rewards.push({
                "cliente": data[i][1],
                "premio": "Set Lavette Profumate + Campione Esclusivo + Sconto 20% a vita"
            });
        } else if (data[i][5] >= 1) {
            rewards.push({
                "cliente": data[i][1],
                "premio": "1 Bucato 500ml + 1 Ambiente 500ml GRATIS"
            });
        }
    }

    return ContentService.createTextOutput(JSON.stringify(rewards))
        .setMimeType(ContentService.MimeType.JSON)
        .setHeader("Access-Control-Allow-Origin", "*")
        .setHeader("Access-Control-Allow-Methods", "POST, GET, OPTIONS")
        .setHeader("Access-Control-Allow-Headers", "Content-Type");
}

